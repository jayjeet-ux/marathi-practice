<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Marathi Letters Practice</title>

<style>
  body{
    margin:0;
    font-family:system-ui, Arial, sans-serif;
    background:#0b0f19;
    color:#eef2ff;
    display:flex;
    align-items:center;
    justify-content:center;
    min-height:100vh;
  }
  .card{
    width:92vw;
    max-width:760px;
    background:#111a2e;
    border-radius:18px;
    padding:22px;
    box-sizing:border-box;
    text-align:center;
  }
  .topRow{
    display:flex;
    gap:10px;
    justify-content:center;
    flex-wrap:wrap;
    margin-bottom:14px;
  }
  .modeBtn{
    border:none;
    border-radius:12px;
    padding:10px 14px;
    cursor:pointer;
    font-size:16px;
    background:rgba(255,255,255,0.10);
    color:#eef2ff;
  }
  .modeBtn.active{
    background:#60a5fa;
    color:#071022;
    font-weight:700;
  }
  .letter{
    font-size:140px;
    line-height:1;
    margin:18px 0 10px 0;
  }
  .hint{
    font-size:22px;
    min-height:30px;
    opacity:0.9;
    margin-bottom:14px;
  }
  .row{
    display:flex;
    gap:14px;
    justify-content:center;
    flex-wrap:wrap;
  }
  button{
    border:none;
    border-radius:14px;
    padding:16px 18px;
    font-size:18px;
    cursor:pointer;
  }
  .soundBtn{
    background:#fbbf24;
    color:#111827;
    font-weight:800;
    min-width:210px;
  }
  .nextBtn{
    background:#22c55e;
    color:#052012;
    font-size:34px;
    width:150px;
    height:74px;
    font-weight:900;
  }
  .tiny{
    margin-top:12px;
    font-size:14px;
    opacity:0.75;
  }
</style>
</head>

<body>
  <div class="card">
    <div class="topRow">
      <button id="modeAll" class="modeBtn active" type="button">All</button>
      <button id="modeVowels" class="modeBtn" type="button">Vowels</button>
      <button id="modeConsonants" class="modeBtn" type="button">Consonants</button>
    </div>

    <div id="letter" class="letter">अ</div>
    <div id="hint" class="hint"></div>

    <div class="row">
      <button id="soundBtn" class="soundBtn" type="button">Play sound</button>
      <button id="nextBtn" class="nextBtn" type="button">Next</button>
    </div>

    <div class="tiny">
      Keyboard, press K to play sound, press right arrow for next.
    </div>
  </div>

<script>
document.addEventListener("DOMContentLoaded", function () {

  const vowels = [
    { id:"a",  mr:"अ",  en:"a"  },
    { id:"aa", mr:"आ",  en:"aa" },
    { id:"e",  mr:"इ",  en:"e"  },
    { id:"ee", mr:"ई",  en:"ee" },
    { id:"u",  mr:"उ",  en:"u"  },
    { id:"uu", mr:"ऊ",  en:"uu" },
    { id:"ae", mr:"ए",  en:"ae" },
    { id:"ai", mr:"ऐ",  en:"ai" },
    { id:"o",  mr:"ओ",  en:"o"  },
    { id:"au", mr:"औ",  en:"au" },
    { id:"am", mr:"अं", en:"am" },
    { id:"ah", mr:"अः", en:"ah" }
  ];

  const consonants = [
    { id:"ka",   mr:"क",  en:"ka"  }, { id:"kha",  mr:"ख",  en:"kha" },
    { id:"ga",   mr:"ग",  en:"ga"  }, { id:"gha",  mr:"घ",  en:"gha" },

    { id:"cha",  mr:"च",  en:"cha" }, { id:"chha", mr:"छ",  en:"chha" },
    { id:"ja",   mr:"ज",  en:"ja"  }, { id:"zha",  mr:"झ",  en:"zha" },

    { id:"ta",   mr:"ट",  en:"ta"  }, { id:"ttha", mr:"ठ",  en:"ttha" },
    { id:"dda",  mr:"ड",  en:"dda" }, { id:"ddha", mr:"ढ",  en:"ddha" },
    { id:"nna",  mr:"ण",  en:"nna" },

    { id:"tta",  mr:"त",  en:"tta" }, { id:"tha",  mr:"थ",  en:"tha" },
    { id:"da",   mr:"द",  en:"da"  }, { id:"dha",  mr:"ध",  en:"dha" },
    { id:"na",   mr:"न",  en:"na"  },

    { id:"pa",   mr:"प",  en:"pa"  }, { id:"pha",  mr:"फ",  en:"pha" },
    { id:"ba",   mr:"ब",  en:"ba"  }, { id:"bha",  mr:"भ",  en:"bha" },
    { id:"ma",   mr:"म",  en:"ma"  },

    { id:"ya",   mr:"य",  en:"ya"  }, { id:"ra",   mr:"र",  en:"ra"  },
    { id:"la",   mr:"ल",  en:"la"  }, { id:"va",   mr:"व",  en:"va"  },

    { id:"sha",  mr:"श",  en:"sha" }, { id:"shha", mr:"ष",  en:"shha" },
    { id:"sa",   mr:"स",  en:"sa"  }, { id:"ha",   mr:"ह",  en:"ha"  },

    { id:"lla",  mr:"ळ",  en:"lla" },
    { id:"ksh",  mr:"क्ष", en:"ksh" },
    { id:"dyna", mr:"ज्ञ", en:"dyna" }
  ];

  const allItems = vowels.concat(consonants);

  const letterEl = document.getElementById("letter");
  const hintEl = document.getElementById("hint");
  const soundBtn = document.getElementById("soundBtn");
  const nextBtn = document.getElementById("nextBtn");

  const modeAll = document.getElementById("modeAll");
  const modeVowels = document.getElementById("modeVowels");
  const modeConsonants = document.getElementById("modeConsonants");

  const player = new Audio();
  player.preload = "auto";

  let mode = "all";
  let pool = allItems;
  let currentIndex = 0;

  const counts = { all:{}, vowels:{}, consonants:{} };

  function initCounts(modeKey, list) {
    counts[modeKey] = {};
    list.forEach(it => { counts[modeKey][it.id] = 0; });
  }

  initCounts("all", allItems);
  initCounts("vowels", vowels);
  initCounts("consonants", consonants);

  function playDing() {
    const AudioCtx = window.AudioContext || window.webkitAudioContext;
    const ctx = new AudioCtx();

    const osc = ctx.createOscillator();
    const gain = ctx.createGain();

    osc.type = "sine";
    osc.frequency.value = 880;
    gain.gain.value = 0.15;

    osc.connect(gain);
    gain.connect(ctx.destination);

    osc.start();
    osc.stop(ctx.currentTime + 0.12);
  }

  function setActiveModeButton() {
    modeAll.classList.toggle("active", mode === "all");
    modeVowels.classList.toggle("active", mode === "vowels");
    modeConsonants.classList.toggle("active", mode === "consonants");
  }

  function getCountsObj() {
    return counts[mode];
  }

  function resetIfDone() {
    const c = getCountsObj();
    const keys = Object.keys(c);
    if (keys.length === 0) return;
    const done = keys.every(k => c[k] >= 2);
    if (done) keys.forEach(k => c[k] = 0);
  }

  function pickIndex() {
    resetIfDone();
    const c = getCountsObj();

    const available = [];
    for (let i = 0; i < pool.length; i++) {
      if ((c[pool[i].id] || 0) < 2) available.push(i);
    }

    if (available.length === 0) {
      Object.keys(c).forEach(k => c[k] = 0);
      for (let i = 0; i < pool.length; i++) available.push(i);
    }

    let idx = available[Math.floor(Math.random() * available.length)];
    if (available.length > 1) {
      while (idx === currentIndex) {
        idx = available[Math.floor(Math.random() * available.length)];
      }
    }
    return idx;
  }

  function render(idx) {
    currentIndex = idx;
    const item = pool[currentIndex];
    const c = getCountsObj();
    c[item.id] = (c[item.id] || 0) + 1;

    letterEl.textContent = item.mr;
    hintEl.textContent = "";
  }

  function nextItem() {
    render(pickIndex());
  }

  function playSound() {
    const item = pool[currentIndex];

    hintEl.textContent = item.en;

    const file = "audio/" + encodeURIComponent(String(item.id).toLowerCase()) + ".m4a";

    player.pause();
    player.currentTime = 0;
    player.src = file;

    player.play().catch(() => {
      hintEl.textContent = "Missing audio file: " + file;
    });
  }

  function setMode(newMode) {
  mode = newMode;
  pool = (mode === "vowels") ? vowels : (mode === "consonants" ? consonants : allItems);

  const c = getCountsObj();
  Object.keys(c).forEach(k => c[k] = 0);

  currentIndex = 0;
  setActiveModeButton();
  nextItem();
  playDing();
}

  modeAll.addEventListener("click", function(){ setMode("all"); });
  modeVowels.addEventListener("click", function(){ setMode("vowels"); });
  modeConsonants.addEventListener("click", function(){ setMode("consonants"); });

  soundBtn.addEventListener("click", playSound);

  nextBtn.addEventListener("click", function () {
    nextItem();
    playDing();
  });

  document.addEventListener("keydown", function(e){
    if (e.key === "ArrowRight") {
      nextItem();
      playDing();
    }
    if (e.key === "k" || e.key === "K") playSound();
  });

  setActiveModeButton();
  setMode("all");
});
</script>

</body>
</html>
